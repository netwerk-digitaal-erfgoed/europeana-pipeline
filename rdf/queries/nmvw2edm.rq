PREFIX owl:     <http://www.w3.org/2002/07/owl#>
PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dc:      <http://purl.org/dc/elements/1.1/>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX skos:    <http://www.w3.org/2004/02/skos/core#>
PREFIX void:    <http://rdfs.org/ns/void#>
PREFIX schema:  <http://schema.org/>
PREFIX edm:     <http://www.europeana.eu/schemas/edm/>
PREFIX ore:     <http://www.openarchives.org/ore/terms/>

CONSTRUCT {
    ?id a edm:ProvidedCHO ;
         edm:type ?edm_type ;
         dc:creator ?creator ;
         dc:description ?description ;
         dc:type ?dc_type ;
         dc:subject ?uri_subject ;
         dc:title ?title ;
         dcterms:spatial ?uri_spatial ;
         dcterms:temporal ?temporal ;
         dcterms:extent ?extent ;
         dcterms:medium ?material .

    ?uri_ore a ore:Aggregation ;
         edm:aggregatedCHO ?id ;
         edm:provider ?provider ;
         edm:dataProvider ?dataProvider ;
         edm:rights ?license ;
         edm:isShownBy ?isShownBy ;
         edm:isShownAt ?url .

     #?uri_thes a skos:Concept ;
     #    skos:prefLabel ?prefLabel ;
     #    skos:broader ?broader ;
     #    skos:altLabel ?altLabel ;
     #    skos:exactMatch ?exactMatch ;
     #    skos:inScheme ?inScheme ;
     #    skos:narrower ?narrower ;
     #    skos:notation ?notation ;
     #    skos:note ?note .
}
WHERE {
     {
      ?id a dcterms:PhysicalResource ;
               edm:type ?edm_type ;
               edm:isShownAt ?url ;
               edm:isShownBy ?isShownBy ;
               edm:provider ?dataProvider .

      # Generate an "URI_CHO#agg" URI pointing to a ore:Aggregation resource.
      BIND( URI(CONCAT(STR(?id),"#agg")) as ?uri_ore)

      # NOTE: The VAR_PROVIDER will be replaced during runtime by the starter.sh script.
      # Europeana requires the provider value to be specified through the aggregation process.
      BIND( STR('VAR_PROVIDER') as ?provider)

      OPTIONAL { ?id dc:creator ?creator }
      OPTIONAL { ?id dc:description ?description }
      OPTIONAL { ?id dc:subject ?uri_subject }
      OPTIONAL { ?id edm:object ?uri_subject }
      OPTIONAL { ?id dc:title ?name }
      OPTIONAL { ?id edm:rights ?license }
      OPTIONAL { ?id dcterms:extent ?extent }
      OPTIONAL { ?id dc:type ?dc_type }
      OPTIONAL { ?id dcterms:spatial ?uri_spatial }
      OPTIONAL { ?id dcterms:created ?temporal }
      OPTIONAL { ?id dcterms:medium ?material }
      BIND( IF(BOUND(?name),?name,"geen titel") as ?title )
    }
    UNION{
      # optional mapping of the thesaurus
      # no mapping needed here because the thesaurus is fully compliant with Europeana mapping rules
      #?uri_thes a skos:Concept .
      #OPTIONAL { ?uri_thes skos:broader ?broader }
      #OPTIONAL { ?uri_thes skos:altLabel ?altLabel }
      #OPTIONAL { ?uri_thes skos:exactMatch ?exactMatch }
      #OPTIONAL { ?uri_thes skos:inScheme ?inScheme }
      #OPTIONAL { ?uri_thes skos:narrower ?narrower }
      #OPTIONAL { ?uri_thes skos:notation ?notation }
      #OPTIONAL { ?uri_thes skos:note ?note }
      #OPTIONAL { ?uri_thes skos:prefLabel ?prefLabel }
    }
}
